# Asset Pricing Architecture (Text Layout)

─────────────────────────────────────────────
USER / APPLICATION LAYER
─────────────────────────────────────────────
- Builds asset objects (e.g., FixedRateBond)
- Loads market data (discount curve)
- Selects and calls the pricing engine

    engine.price(asset, asof, curve)

─────────────────────────────────────────────
PRICING ENGINE  ← the "tool"
─────────────────────────────────────────────
Purpose: Combine asset cashflows with curve data.

Receives:
    • Asset  →  provides cashflow dates & amounts
    • Curve  →  provides discount factors

Does:
    • Discount each cashflow
    • Sum to get PV / price
    • Optionally compute yield, duration, spread

Returns:
    • Price, Yield, Duration, PV01, etc.

─────────────────────────────────────────────
ASSET HIERARCHY
─────────────────────────────────────────────
Parent class:
    Asset (abstract)
      ├─ defines schedule(), cashflows()
      ├─ holds identifiers (id, issue, maturity, nominal)
      └─ contains only deterministic logic
         (no curve or pricing code)

Child classes:
    ├─ FixedRateBond      → fixed coupons
    ├─ FloatingRateNote   → index + spread coupons
    ├─ ZeroCouponBond     → single maturity payment
    ├─ AmortizingLoan     → principal paid over time
    └─ CallableBond       → optional call / put features

Each child implements:
    • build_schedule()
    • cashflow_components(date)
Parent provides:
    • cashflows()  → generic aggregation of components

─────────────────────────────────────────────
MARKET DATA LAYER
─────────────────────────────────────────────
DiscountCurve
    • df(date) → discount factor
    • forward(start, end) → forward rate
    • Holds pillar dates, discount factors, interpolation rules
    • Pure data object, no asset logic

─────────────────────────────────────────────
OPTIONAL UTILITIES
─────────────────────────────────────────────
ScheduleBuilder  – constructs business-day-adjusted schedules  
DayCount         – computes year fractions  
BusinessCalendar – defines holiday / roll conventions  

─────────────────────────────────────────────
DATA FLOW SUMMARY
─────────────────────────────────────────────
[User/App]
     │
     ▼
[Asset child class]
     │  build_schedule(), cashflow_components()
     ▼
[Asset.cashflows()]  → dates, amounts
     │
     ▼
[PricingEngine]  ← calls →  [DiscountCurve.df(date)]
     │
     ▼
[Results: Price, Yield, Duration, PV01]

─────────────────────────────────────────────
DO / DON'T CHECKLIST
─────────────────────────────────────────────
DO:
  • Keep Asset free of market data.
  • Centralize pricing/curve math in PricingEngine.
  • Reuse one engine for all bond types.
  • Validate schedules & cashflows in parent.

DON’T:
  • Duplicate pricing functions in each child.
  • Mix schedule logic with discounting.
  • Depend on curve objects inside Asset classes.
